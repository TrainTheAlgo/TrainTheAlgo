<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <!-- The title and description will be updated dynamically based on the category -->
    <title>Category Posts</title>
    <meta name="description" content="Posts by Category">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet" />
  </head>
  <body class="bg-gray-100 text-gray-800">
    <!-- Menu Placeholder (loaded via JS) -->
    <div id="menu-placeholder"></div>

    <!-- Hero Section -->
    <header class="relative mt-16">
      <div class="relative h-96 overflow-hidden">
        <!-- The hero image will be set dynamically. A default image is provided as a fallback -->
        <img
          id="hero-image"
          class="absolute top-0 left-0 w-full h-full object-cover"
          src="/default-hero.jpg"
          alt="Hero Image"
        />
      </div>
      <div
        class="absolute inset-0 bg-black bg-opacity-70 flex flex-col items-center text-center justify-center"
      >
        <!-- The hero title is updated based on the selected category -->
        <h1 id="hero-title" class="text-2xl md:text-3xl text-white font-bold">Category</h1>
      </div>
    </header>

    <!-- Main Content Section -->
    <main class="max-w-6xl mx-auto p-4 my-8">
      <section id="latest-posts" class="my-8">
        <!-- Section heading will be updated to reflect the current category -->
        <h2 id="section-heading" class="text-3xl font-bold border-b pb-2 mb-4">Posts</h2>
        <div id="posts-container" class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <!-- Post cards will be dynamically injected here -->
        </div>
      </section>
    </main>

    <!-- Footer Placeholder (loaded via JS) -->
    <div id="footer-placeholder"></div>

    <script>
      // Utility: Load external HTML content (for menu and footer)
      function loadHTML(selector, url) {
        fetch(url)
          .then(response => response.text())
          .then(data => {
            document.querySelector(selector).innerHTML = data;
          })
          .catch(err => console.error('Error loading HTML:', err));
      }
      loadHTML('#menu-placeholder', '/menu.html');
      loadHTML('#footer-placeholder', '/footer.html');

      // Utility: Retrieve a URL query parameter by name
      function getQueryParam(param) {
        const urlParams = new URLSearchParams(window.location.search);
        return urlParams.get(param);
      }

      // Get the category from the query string (?cat=...)
      const categoryParam = getQueryParam('cat');

      if (!categoryParam) {
        document.getElementById('section-heading').innerText = 'No Category Specified';
      } else {
        // Format the category (assuming JSON categories are capitalized)
        const formattedCategory =
          categoryParam.charAt(0).toUpperCase() + categoryParam.slice(1).toLowerCase();

        // Update hero and section headings with the current category
        document.getElementById('hero-title').innerText = formattedCategory + ' Posts';
        document.getElementById('section-heading').innerText = formattedCategory + ' Posts';

        // Fetch the posts data from /index.json
        fetch('/index.json')
          .then(response => response.json())
          .then(data => {
            // Filter the posts by category (case-insensitive comparison)
            const posts = data.filter(
              post => post.category.toLowerCase() === formattedCategory.toLowerCase()
            );

            // If there are posts, set the hero image to the first postâ€™s image
            if (posts.length > 0) {
              document.getElementById('hero-image').src = '/images/' + posts[0].image;
              document.getElementById('hero-image').alt = posts[0].title;
            } else {
              // If no posts are found, leave the default hero image and display a message
              document.getElementById('posts-container').innerHTML =
                '<p>No posts found for this category.</p>';
              return;
            }

            // Clear any existing content in the posts container
            const postsContainer = document.getElementById('posts-container');
            postsContainer.innerHTML = '';

            // For each post, create and append a post card element
            posts.forEach(post => {
              // Construct the link to the individual post page (assuming post.html uses a slug query parameter)
              const postLink = document.createElement('a');
              postLink.href = 'post.html?slug=' + post.slug;
              postLink.className = 'block';
              postLink.innerHTML = `
                <div class="relative rounded shadow overflow-hidden h-48 group">
                  <div class="absolute inset-0 bg-cover" style="background-image: url('/images/${post.image}');"></div>
                  <div class="absolute inset-0 bg-white cursor-pointer opacity-90 group-hover:opacity-50 group-hover:bg-black transition duration-300"></div>
                  <div class="relative p-4">
                    <h3 class="text-xl font-semibold transition duration-300 group-hover:text-white">
                      ${post.title}
                    </h3>
                    <p class="text-sm mt-2 transition duration-300 group-hover:text-white">
                      ${post.description}
                    </p>
                  </div>
                </div>
              `;
              postsContainer.appendChild(postLink);
            });
          })
          .catch(err => console.error('Error loading posts:', err));
      }
    </script>
  </body>
</html>
